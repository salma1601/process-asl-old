=====================
Introduction: procasl
=====================

.. contents:: **Contents**
    :local:
    :depth: 1


What is procasl: preprocessing and quantification of ASL data
=============================================================

.. topic:: **Why use procasl?**

    Procasl builds relevant **pipelines** for processing arterial speen labeling (ASL) data (
    :ref:`single subject pipeline <single_subject>`,
    :ref:`second level pipeline <second_level>`).

    Procasl can be used on :ref:`pulsed ASL <pulsed_asl_example.py>`
    and adapted to :ref:`pseudo-continuous ASL <pc_asl>`data.


ASL basics
==========

Weighting the MRI signal by cerebral blood flow
-----------------------------------------------
citation

Blood flows from carotid arteries to capilleray bed. The volume of arterial blood (mL) delivered to 100 g of tissue per minute is called the Cerebral Blood Flow (CBF). In human brain, it has a typical value of 60 mL/100 g-minute. CBF is a fundamental physiological quantity, closely related to brain function []. It is an important indicator of tissue health [] as well as neuronal activity [].

Prior to ASL, the techniques used for determining cerebral blood flow were rather invasive and involved the 
use of exogenous contrast agents, such as the 15O H2O radiotracer in Positron Emission Tomography (PET) and ... in [nitrous oxide method, perfusion
CT and DSC-MRI].


Imaging principle: Labeling arterial blood water magnetically
-------------------------------------------------------------
Similar to these techniques, ASL is based on tracer kinetics but with no contrast agent: blood is used as a tracer by inverting its longitudinal relaxation.

Magnetization is tagged sequentially to capture the flowing of the arterial blood.

First, arterial blood water is magnetically labeled just below the region (slice) of interest by applying a 180 degree radiofrequency (RF) inversion pulse. The result of this pulse is inversion of the net magnetization of the blood water. After a period of time (called the transit time), this 'paramagnetic tracer’ flows into the slice of interest where it exchanges with tissue water. The inflowing inverted spins within the blood water alter total tissue magnetization, reducing it and, consequently, the MR signal & image intensity. During this time, an image is taken (called the tag image). 
The experiment is then repeated without labeling the arterial blood to create another image (called the control image). The control image and the tag image are subtracted to produce a perfusion image. This image will reflect the amount of arterial blood delivered to each voxel within the slice within the transit time.

Many modalities and many sequences exist, and ASL techniques is an active research field.
More on http://fmri.research.umich.edu/research/main_topics/asl.php


From ASL images to CBF: Quantification how tos
----------------------------------------------
CBF ~ M_ctl - M_tag
To obtain absolute perfusion (CBF) in ml/100ml/min,
the mean difference image is multiplied by constant factors.
This scaling is essential for “whole brain” diseases,
like large vessel occlusive disease, neurodegenerative
disease, sickle cell disease, etc . It plays an important role when
comparing patients to controls, to avoid misinterpreting a difference in
these factors (T1, labeling efficiency) as a difference in brain perfusion.

Some factors, such as transit time or labeling efficiency for
different arteries, vary within the ASL-image and therefore will
change relative perfusion. 

- How does disease affect blood flow distribution

- Relative perfusion of tumor compared to normal appearing
GM/WM

- Comparison with contralateral hemisphere

Correction for regional differences is thus important and can be done through
more elaborate methods and additionnal acquisitions.
This model is simplified, but is recommended for its
robustness and simplicity, and because more complete
models require additional information that involves
more scan time, and often only reduces systematic errors
at the cost of SNR. Types of additional information
include ATT, water exchange rates and times between
blood and tissue, tissue T 1 values, and tissue segmenta-
tion. Ongoing active research aims to more fully under-
stand the range and effects of these parameters, but the
complexity, uncertainty, and additional noise associated
with correcting for these factors was deemed to be coun-
terproductive as a default protocol at this stage of adop-
tion of clinical ASL.


:General kinetic model:

:The parameters:


Applications
------------
The cerebral blood flow (CBF) is a fundamental physiological quantity, closely related to brain function.

:Diagnosis:

:An accurate hemodynamics estimation:

:Assessing the neural contribution in activation BOLD signal:


Whetting Your Appetite
----------------------


Installation
============
**Configuring FSL**: On an Ubuntu system, FSL is usually installed at :: /usr/share/fsl. You need to add this location to your .bashrc file. Edit this file by running the shell command::

    gedit ~/.bashrc

and add the following lines::

    # FSL
    FSLDIR=/usr/share/fsl
    . ${FSLDIR}/5.0/etc/fslconf/fsl.sh
    PATH=${FSLDIR}/5.0/bin:${PATH}
    export FSLDIR PATH

To test if FSL is correctly installed, open a new terminal and type in the shell command::

    fsl

You should see the FSL GUI with the version number in the header.

**Configuring SPM**: Add the following lines specifying the location of the spm folder to your .bashrc file::

    # SPM8
    export SPM_PATH=/i2bm/local/spm8-standalone/spm8_mcr/spm8

**Downloading procasl:** Run the shell command::

    git clone https://github.com/salma1601/process-asl


**Installing procasl:** In the ``process-asl`` directory created by the previous step, run
(again, as a shell command)::

    python setup.py install --user

**Testing the installation:** To check whether everything is set up correctly, open IPython and type
in the following line::

    In [1]: import procasl

If no error occurs, you have installed procasl correctly.
